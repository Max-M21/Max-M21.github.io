<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>World Quiz ‚Äî 196 Countries</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Guess the country by its outline. Includes 196 countries as per your list." />
  <style>
    :root {
      --bg:#0b0f17; --panel:#101826; --text:#e5e7eb; --muted:#9ca3af; --accent:#60a5fa; --ok:#34d399; --bad:#f87171;
    }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 800px at 10% -10%, #111b2e, #0b0f17); color:var(--text); font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    header{padding:1rem 0}
    .container{width:min(1100px,92%); margin:0 auto}
    h1{font-size:clamp(1.4rem,1.4rem + 1vw,2rem); margin:.2rem 0 .6rem}
    .muted{color:var(--muted)}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:1rem; backdrop-filter:blur(8px)}
    .ui{display:grid; gap:.75rem; grid-template-columns: 1fr; align-items:center}
    .row{display:flex; gap:.5rem; align-items:center; flex-wrap:wrap}
    input[type="text"]{flex:1; min-width:220px; padding:.8rem 1rem; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:var(--panel); color:var(--text)}
    button{padding:.75rem 1rem; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:var(--panel); color:var(--text); cursor:pointer}
    button.primary{background:var(--accent); color:#001a33; border-color:transparent; font-weight:700}
    button[disabled]{opacity:.6; cursor:not-allowed}
    .pill{display:inline-flex; gap:.4rem; align-items:center; padding:.35rem .6rem; border-radius:999px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.04); font-size:.9rem}
    .pill.ok{border-color:rgba(52,211,153,.4); background:rgba(52,211,153,.08)}
    .pill.bad{border-color:rgba(248,113,113,.4); background:rgba(248,113,113,.08)}
    #mapWrap{margin-top:1rem}
    svg{width:100%; height:auto; display:block; background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01)); border:1px solid rgba(255,255,255,.06); border-radius:16px}
    .land{fill:#0f172a; stroke:#1f2937; stroke-width:.5}
    .country{fill:none; stroke:transparent}
    .active{fill:none; stroke:var(--accent); stroke-width:1.8; pointer-events:none}
    .correctFlash{animation: flashOk .5s}
    .wrongShake{animation: shake .25s}
    @keyframes flashOk {from {background:rgba(52,211,153,.15)} to {background:transparent}}
    @keyframes shake {10%, 90% { transform: translateX(-2px) } 20%, 80% { transform: translateX(4px) } 30%, 50%, 70% { transform: translateX(-6px) } 40%, 60% { transform: translateX(6px) }}
    footer{padding:2rem 0; text-align:center; color:var(--muted)}
    .small{font-size:.92rem}
  </style>
</head>
<body>
  <header class="container">
    <h1>üåç World Quiz <span class="muted">‚Äî 196 countries</span></h1>
    <div class="panel ui">
      <div class="row">
        <input id="guess" type="text" placeholder="Type the country name‚Ä¶ (press Enter)" autocomplete="off" />
        <button id="submit" class="primary">Submit</button>
        <button id="skip">Skip</button>
        <button id="restart" title="Start over">Restart</button>
      </div>
      <div class="row small">
        <span class="pill" id="status">Loading map‚Ä¶</span>
        <span class="pill">‚è±Ô∏è Time: <strong id="timer">00:00</strong></span>
        <span class="pill">‚úÖ Correct: <strong id="correct">0</strong></span>
        <span class="pill">üèÅ Remaining: <strong id="remaining">0</strong> / <strong id="total">196</strong></span>
      </div>
    </div>
  </header>

  <main class="container">
    <div id="mapWrap">
      <svg id="map" viewBox="0 0 960 520" aria-label="World map for country quiz"></svg>
    </div>
  </main>

  <footer class="container">
    <small>Map data ¬© Natural Earth. Rendered with D3 + TopoJSON. Targets: your 196-country list.</small>
  </footer>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/topojson-client@3/dist/topojson-client.min.js"></script>
  <script>
    // ---------- utilities ----------
    const $ = sel => document.querySelector(sel);
    const pad2 = n => n.toString().padStart(2,'0');
    const normalize = s => s
      .toLowerCase()
      .normalize('NFD').replace(/[\u0300-\u036f]/g,'') // strip diacritics
      .replace(/['‚Äô`]+/g, " ") // apostrophes -> space
      .replace(/[^a-z0-9]+/g,' ') // squash punctuation
      .trim();

    // ---------- your exact 196 list ----------
    const TARGET_196_RAW = `
Afghanistan	Albania	Algeria	Andorra	Angola
Antigua and Barbuda	Argentina	Armenia	Australia	Austria
Azerbaijan	Bahamas	Bahrain	Bangladesh	Barbados
Belarus	Belgium	Belize	Benin	Bhutan
Bolivia	Bosnia and Herzegovina	Botswana	Brazil	Brunei
Bulgaria	Burkina Faso	Burma	Burundi	Cambodia
Cameroon	Canada	Cape Verde	Central African Republic	Chad
Chile	China	Colombia	Comoros	Costa Rica
Cote d'Ivoire	Croatia	Cuba	Cyprus	Czech Republic
Democratic Republic of the Congo	Denmark	Djibouti	Dominica	Dominican Republic
East Timor	Ecuador	Egypt	El Salvador	Equatorial Guinea
Eritrea	Estonia	Ethiopia	Federated States of Micronesia	Fiji
Finland	France	Gabon	Gambia	Georgia
Germany	Ghana	Greece	Grenada	Guatemala
Guinea	Guinea-Bissau	Guyana	Haiti	Honduras
Hungary	Iceland	India	Indonesia	Iran
Iraq	Ireland	Israel	Italy	Jamaica
Japan	Jordan	Kazakhstan	Kenya	Kiribati
Kosovo	Kuwait	Kyrgyzstan	Laos	Latvia
Lebanon	Lesotho	Liberia	Libya	Liechtenstein
Lithuania	Luxembourg	Macedonia	Madagascar	Malawi
Malaysia	Maldives	Mali	Malta	Marshall Islands
Mauritania	Mauritius	Mexico	Moldova	Monaco
Mongolia	Montenegro	Morocco	Mozambique	Namibia
Nauru	Nepal	Netherlands	New Zealand	Nicaragua
Niger	Nigeria	North Korea	Norway	Oman
Pakistan	Palau	Panama	Papua New Guinea	Paraguay
Peru	Philippines	Poland	Portugal	Qatar
Republic of the Congo	Romania	Russia	Rwanda	Saint Kitts and Nevis
Saint Lucia	Saint Vincent and the Grenadines	Samoa	San Marino	Sao Tome and Principe
Saudi Arabia	Senegal	Serbia	Seychelles	Sierra Leone
Singapore	Slovakia	Slovenia	Solomon Islands	Somalia
South Africa	South Korea	South Sudan	Spain	Sri Lanka
Sudan	Suriname	Swaziland	Sweden	Switzerland
Syria	Taiwan	Tajikistan	Tanzania	Thailand
Togo	Tonga	Trinidad and Tobago	Tunisia	Turkey
Turkmenistan	Tuvalu	Uganda	Ukraine	United Arab Emirates
United Kingdom	United States	Uruguay	Uzbekistan	Vanuatu
Vatican City	Venezuela	Vietnam	Yemen	Zambia
Zimbabwe
`;
    const TARGET_196 = TARGET_196_RAW.split(/\s{2,}|\t|\n/).map(s=>s.trim()).filter(Boolean);
    const TARGET_196_SET = new Set(TARGET_196.map(s => normalize(s)));

    // ---------- name remaps to match your list ----------
    const NAME_REMAP = new Map(Object.entries({
      "czechia": "czech republic",
      "myanmar": "burma",
      "eswatini": "swaziland",
      "cabo verde": "cape verde",
      "timor leste": "east timor",
      "timor-leste": "east timor",
      "lao people s democratic republic": "laos",
      "russian federation": "russia",
      "republic of moldova": "moldova",
      "united republic of tanzania": "tanzania",
      "syrian arab republic": "syria",
      "palestine": "palestine", // not in your 196, harmless
      "state of palestine": "palestine", // harmless if present
      "micronesia": "federated states of micronesia",
      "federated states of micronesia": "federated states of micronesia",
      "congo": "republic of the congo",
      "democratic republic of the congo": "democratic republic of the congo",
      "north macedonia": "macedonia",
      "cote d ivoire": "cote d'ivoire",
      "c√¥te d ivoire": "cote d'ivoire",
      "korea republic of": "south korea",
      "republic of korea": "south korea",
      "korea democratic people s republic of": "north korea",
      "democratic people s republic of korea": "north korea"
    }));

    // ---------- extra input aliases for nicer UX ----------
    // (Accept both your names and common alternates)
    const ALIASES = new Map(Object.entries({
      "czech republic": ["czechia"],
      "burma": ["myanmar"],
      "swaziland": ["eswatini"],
      "cape verde": ["cabo verde"],
      "east timor": ["timor leste","timor-leste"],
      "federated states of micronesia": ["micronesia","fsm"],
      "republic of the congo": ["congo brazzaville","roc","congo"],
      "democratic republic of the congo": ["dr congo","drc","congo kinshasa"],
      "macedonia": ["north macedonia"],
      "cote d'ivoire": ["cote divoire","c√¥te d‚Äôivoire","cote d ivoire","ivory coast"],
      "south korea": ["republic of korea","korea republic of"],
      "north korea": ["dprk","democratic people s republic of korea"],
      "united states": ["usa","us","u.s.","u.s.a","united states of america"],
      "united kingdom": ["uk","u.k.","great britain","britain"],
      "uae": ["united arab emirates"],
      "turkey": ["turkiye"],
    }));

    // ---------- UI refs ----------
    const ui = {
      guess: $('#guess'),
      submit: $('#submit'),
      skip: $('#skip'),
      restart: $('#restart'),
      status: $('#status'),
      timer: $('#timer'),
      correct: $('#correct'),
      remaining: $('#remaining'),
      total: $('#total')
    };
    ui.total.textContent = "196";

    // ---------- D3 map setup ----------
    const svg = d3.select('#map');
    const g = svg.append('g');
    const projection = d3.geoNaturalEarth1().fitSize([960, 520], {type:"Sphere"});
    const path = d3.geoPath(projection);

    // Background graticule
    g.append('path').datum({type:'Sphere'}).attr('d', path).attr('fill','none');
    const graticule = d3.geoGraticule();
    g.append('path').datum(graticule()).attr('d', path).attr('fill','none').attr('stroke','#233046').attr('stroke-width',.5).attr('opacity',.25);

    const landLayer = g.append('g').attr('aria-hidden','true');
    const focusLayer = g.append('g');

    // ---------- game state ----------
    let features = [];
    let order = [];
    let iCurrent = -1;
    let startedAt = null;
    let timerId = null;
    let correctCount = 0;
    let finished = false;

    // ---------- data sources (try primary then fallback) ----------
    const SOURCES = [
      { type: 'topojson', url: 'https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json', obj: 'countries' },
      // Fallback: older atlas (naming may differ)
      { type: 'topojson', url: 'https://cdn.jsdelivr.net/npm/world-atlas@1/world/110m.json', obj: 'countries' },
    ];

    (async function init() {
      for (const src of SOURCES) {
        try {
          const res = await fetch(src.url);
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const data = await res.json();

          let countryFeatures = [];
          if (src.type === 'topojson') {
            const obj = data.objects[src.obj] || data.objects.countries;
            if (!obj) throw new Error('TopoJSON countries object missing');
            const geo = topojson.feature(data, obj);
            countryFeatures = geo.features;
          } else {
            countryFeatures = data.features;
          }

          // Map, remap names, and filter strictly to your 196 list
          features = countryFeatures.map(f => {
              const raw = (f.properties && (f.properties.name || f.properties.NAME || f.properties.admin)) || null;
              if (!raw) return null;
              const nRaw = normalize(raw);
              const remapped = NAME_REMAP.get(nRaw) || raw;
              const nRemap = normalize(remapped);
              if (!TARGET_196_SET.has(nRemap)) return null; // keep only your set
              return { ...f, properties: { ...f.properties, name: remapped } };
            })
            .filter(Boolean);

          if (features.length >= 196) {
            console.log(`Loaded ${features.length} features from ${src.url}`);
            break; // success
          } else {
            console.warn(`Only ${features.length} features from ${src.url}; trying fallback...`);
            features = []; // reset and try next
          }
        } catch (e) {
          console.warn(`Failed loading ${src.url}:`, e);
          features = [];
        }
      }

      if (features.length === 0) {
        ui.status.textContent = "Failed to load map data. Check your connection and refresh.";
        ui.status.className = 'pill bad';
        return;
      }

      // Draw dim land for context (only included features for clarity)
      landLayer.selectAll('path.land')
        .data(features)
        .enter().append('path')
        .attr('class','land')
        .attr('d', path);

      startGame();
    })();

    // ---------- game logic ----------
    function startGame() {
      order = d3.shuffle(d3.range(features.length));
      iCurrent = -1;
      correctCount = 0;
      finished = false;
      ui.correct.textContent = '0';
      ui.remaining.textContent = features.length;
      ui.status.textContent = "Type the country name and press Enter.";
      ui.status.className = 'pill';

      startedAt = null;
      ui.timer.textContent = "00:00";
      if (timerId) clearInterval(timerId);
      timerId = setInterval(updateTimer, 250);

      nextCountry();
      ui.guess.value = "";
      ui.guess.focus();

      // If not exactly 196, let user know (but still playable)
      if (features.length !== 196) {
        console.warn(`Note: dataset loaded ${features.length} / 196 from sources. If you need exactly 196, try another world-atlas build that includes all geometries (often Kosovo).`);
      }
    }

    function updateTimer() {
      if (!startedAt) return;
      const elapsedMs = Date.now() - startedAt.getTime();
      const s = Math.floor(elapsedMs / 1000);
      ui.timer.textContent = `${pad2(Math.floor(s / 60))}:${pad2(s % 60)}`;
    }

    function showActiveCountry(feature) {
      focusLayer.selectAll('*').remove();
      focusLayer.append('path')
        .datum(feature)
        .attr('class','active country')
        .attr('d', path);

      const [[x0,y0],[x1,y1]] = path.bounds(feature);
      const pad = 20;
      const scale = Math.min(960 / (x1 - x0 + pad), 520 / (y1 - y0 + pad));
      const cx = (x0 + x1) / 2, cy = (y0 + y1) / 2;
      const t = d3.zoomIdentity
        .translate(960/2, 520/2)
        .scale(Math.min(scale, 6))
        .translate(-cx, -cy);
      g.attr('transform', t.toString());
    }

    function nextCountry() {
      iCurrent++;
      if (iCurrent === 0) startedAt = new Date();
      if (iCurrent >= order.length) return win();
      const feature = features[ order[iCurrent] ];
      showActiveCountry(feature);
      ui.remaining.textContent = (order.length - iCurrent).toString();
      ui.status.textContent = `Which country is outlined?`;
      ui.status.className = 'pill';
    }

    function canonicalName(name) {
      const n = normalize(name);
      // resolve alias to canonical key if provided
      for (const [canon, list] of ALIASES.entries()) {
        const c = normalize(canon);
        if (n === c) return c;
        if (list.some(a => normalize(a) === n)) return c;
      }
      return n;
    }

    function currentAnswerSet() {
      const name = features[ order[iCurrent] ].properties.name;
      const canon = canonicalName(name);
      const set = new Set([canon, normalize(name)]);
      // include aliases for this canonical name
      for (const [c, list] of ALIASES.entries()) {
        if (normalize(c) === canon) list.forEach(a => set.add(normalize(a)));
      }
      return set;
    }

    function submitGuess() {
      if (finished || iCurrent < 0) return;
      const guess = ui.guess.value;
      if (!guess.trim()) return;

      const answers = currentAnswerSet();
      const ok = answers.has(canonicalName(guess));

      if (ok) {
        correctCount++;
        ui.correct.textContent = String(correctCount);
        ui.status.textContent = "Correct!";
        ui.status.className = 'pill ok';
        $('#mapWrap').classList.remove('wrongShake');
        $('#mapWrap').classList.add('correctFlash');
        setTimeout(() => $('#mapWrap').classList.remove('correctFlash'), 300);
        ui.guess.value = "";
        nextCountry();
      } else {
        ui.status.textContent = "Not quite ‚Äî try again or Skip.";
        ui.status.className = 'pill bad';
        $('#mapWrap').classList.remove('correctFlash');
        $('#mapWrap').classList.add('wrongShake');
        setTimeout(() => $('#mapWrap').classList.remove('wrongShake'), 250);
        ui.guess.focus();
      }
    }

    function skipCountry() {
      if (finished || iCurrent < 0) return;
      const idx = order[iCurrent];
      order.push(idx);
      nextCountry();
      ui.status.textContent = "Skipped. It‚Äôll come back later.";
      ui.status.className = 'pill';
      ui.guess.value = "";
      ui.guess.focus();
    }

    function win() {
      finished = true;
      if (timerId) clearInterval(timerId);
      ui.remaining.textContent = "0";
      const time = ui.timer.textContent;
      ui.status.textContent = `üéâ All done! Time: ${time}. Press Restart to play again.`;
      ui.status.className = 'pill ok';
      g.attr('transform', d3.zoomIdentity.toString());
    }

    // ---------- events ----------
    ui.submit.addEventListener('click', submitGuess);
    ui.skip.addEventListener('click', skipCountry);
    ui.restart.addEventListener('click', startGame);
    ui.guess.addEventListener('keydown', e => { if (e.key === 'Enter') submitGuess(); });
  </script>
</body>
</html>
